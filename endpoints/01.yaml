name: Audience
description: |-
  Audience subscription APIs

  Endpoints to subscribe by email, confirm subscription via a signed link,
  and unsubscribe either via a signed link or from an authenticated account.
endpoints:
  -
    custom: []
    httpMethods:
      - POST
    uri: api/v1/audience/subscribe
    metadata:
      custom: []
      groupName: Audience
      groupDescription: |-
        Audience subscription APIs

        Endpoints to subscribe by email, confirm subscription via a signed link,
        and unsubscribe either via a signed link or from an authenticated account.
      subgroup: ''
      subgroupDescription: ''
      title: 'Subscribe to newsletter'
      description: |-
        Creates a new subscriber with Pending status or resends a confirmation
        for an existing Pending/Unsubscribed email. If already Active, nothing is sent.

        Notes:
        - Protected by basic rate limiting.
        - Includes a honeypot field `website` which must be empty (bots fill it and will be rejected).
      authenticated: false
      deprecated: false
    headers:
      Content-Type: application/json
      Accept: application/json
    urlParameters: []
    cleanUrlParameters: []
    queryParameters: []
    cleanQueryParameters: []
    bodyParameters:
      email:
        custom: []
        name: email
        description: 'Subscriber email.'
        required: true
        example: john.doe@example.com
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
      name:
        custom: []
        name: name
        description: 'The name of the subscriber.'
        required: false
        example: 'John Doe'
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
      consent:
        custom: []
        name: consent
        description: 'Must be accepted.'
        required: true
        example: true
        type: boolean
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
      source:
        custom: []
        name: source
        description: 'Optional source tag.'
        required: false
        example: footer_form
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
      website:
        custom: []
        name: website
        description: 'Honeypot field; must be empty.'
        required: false
        example: architecto
        type: string
        enumValues: []
        exampleWasSpecified: false
        nullable: false
        deprecated: false
    cleanBodyParameters:
      email: john.doe@example.com
      name: 'John Doe'
      consent: true
      source: footer_form
      website: architecto
    fileParameters: []
    responses:
      -
        custom: []
        status: 200
        content: '{"message":"Мы отправили письмо с подтверждением на ваш email"}'
        headers: []
        description: 'New subscriber created'
      -
        custom: []
        status: 200
        content: '{"message":"Вы уже подписаны"}'
        headers: []
        description: 'Already active'
      -
        custom: []
        status: 200
        content: '{"message":"Мы уже отправили вам письмо с подтверждением. Отправили ещё раз"}'
        headers: []
        description: Resent
    responseFields: []
    auth: []
    controller: null
    method: null
    route: null
  -
    custom: []
    httpMethods:
      - GET
    uri: api/v1/audience/confirm
    metadata:
      custom: []
      groupName: Audience
      groupDescription: |-
        Audience subscription APIs

        Endpoints to subscribe by email, confirm subscription via a signed link,
        and unsubscribe either via a signed link or from an authenticated account.
      subgroup: ''
      subgroupDescription: ''
      title: 'Confirm subscription (signed)'
      description: |-
        Confirms a subscriber by email using a temporary signed URL sent in the confirmation email.
        On success, redirects to the frontend success page.
      authenticated: false
      deprecated: false
    headers:
      Content-Type: application/json
      Accept: application/json
    urlParameters: []
    cleanUrlParameters: []
    queryParameters:
      email:
        custom: []
        name: email
        description: 'Email to confirm.'
        required: true
        example: john.doe@example.com
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
    cleanQueryParameters:
      email: john.doe@example.com
    bodyParameters: []
    cleanBodyParameters: []
    fileParameters: []
    responses:
      -
        custom: []
        status: 302
        content: ''
        headers: []
        description: 'Success: redirect to success page'
      -
        custom: []
        status: 302
        content: ''
        headers: []
        description: 'Error: redirect to error page'
      -
        custom: []
        status: 403
        content: |-
          {
              "message": "Invalid signature."
          }
        headers:
          cache-control: 'no-cache, private'
          content-type: application/json
          access-control-allow-origin: 'http://localhost:3000'
          access-control-allow-credentials: 'true'
        description: null
    responseFields: []
    auth: []
    controller: null
    method: null
    route: null
  -
    custom: []
    httpMethods:
      - GET
    uri: api/v1/audience/unsubscribe
    metadata:
      custom: []
      groupName: Audience
      groupDescription: |-
        Audience subscription APIs

        Endpoints to subscribe by email, confirm subscription via a signed link,
        and unsubscribe either via a signed link or from an authenticated account.
      subgroup: ''
      subgroupDescription: ''
      title: 'Unsubscribe (signed)'
      description: |-
        Unsubscribes a subscriber by email using a temporary signed URL.
        Always redirects to the frontend unsubscribe page if successful,
        otherwise redirects to an error page.
      authenticated: false
      deprecated: false
    headers:
      Content-Type: application/json
      Accept: application/json
    urlParameters: []
    cleanUrlParameters: []
    queryParameters:
      email:
        custom: []
        name: email
        description: 'Email to unsubscribe.'
        required: true
        example: john.doe@example.com
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
    cleanQueryParameters:
      email: john.doe@example.com
    bodyParameters: []
    cleanBodyParameters: []
    fileParameters: []
    responses:
      -
        custom: []
        status: 302
        content: ''
        headers: []
        description: 'Success: redirect to unsubscribed page'
      -
        custom: []
        status: 302
        content: ''
        headers: []
        description: 'Error: redirect to error page'
      -
        custom: []
        status: 403
        content: |-
          {
              "message": "Invalid signature."
          }
        headers:
          cache-control: 'no-cache, private'
          content-type: application/json
          access-control-allow-origin: 'http://localhost:3000'
          access-control-allow-credentials: 'true'
        description: null
    responseFields: []
    auth: []
    controller: null
    method: null
    route: null
  -
    custom: []
    httpMethods:
      - POST
    uri: api/v1/audience/unsubscribe
    metadata:
      custom: []
      groupName: Audience
      groupDescription: |-
        Audience subscription APIs

        Endpoints to subscribe by email, confirm subscription via a signed link,
        and unsubscribe either via a signed link or from an authenticated account.
      subgroup: ''
      subgroupDescription: ''
      title: 'Unsubscribe from account'
      description: 'Unsubscribes the currently authenticated user by their account email.'
      authenticated: true
      deprecated: false
    headers:
      Authorization: 'Bearer {YOUR_AUTH_KEY}'
      Content-Type: application/json
      Accept: application/json
    urlParameters: []
    cleanUrlParameters: []
    queryParameters: []
    cleanQueryParameters: []
    bodyParameters: []
    cleanBodyParameters: []
    fileParameters: []
    responses:
      -
        custom: []
        status: 204
        content: ''
        headers: []
        description: Success
      -
        custom: []
        status: 401
        content: ''
        headers: []
        description: Unauthenticated
      -
        custom: []
        status: 404
        content: ''
        headers: []
        description: 'Subscriber not found'
    responseFields: []
    auth:
      - headers
      - Authorization
      - 'Bearer 6g43cv8PD1aE5beadkZfhV6'
    controller: null
    method: null
    route: null
  -
    custom: []
    httpMethods:
      - POST
    uri: 'api/v1/audience/webhooks/{provider}'
    metadata:
      custom: []
      groupName: Audience
      groupDescription: |-
        Mailing service webhooks

        Endpoint to receive webhook events from external mailing providers
        and synchronize local subscriber statuses.
      subgroup: ''
      subgroupDescription: ''
      title: 'Handle mailing provider webhook'
      description: |-
        Verifies the request using the selected provider driver and applies
        the mapped event to a local subscriber (e.g., activate / unsubscribe).

        Notes:
        - Authentication is handled by the provider-specific signature check.
        - For the built-in "null" driver, all requests are accepted and the payload
          is mapped using simple fields: email + status (active|unsubscribed).
      authenticated: false
      deprecated: false
    headers:
      Content-Type: application/json
      Accept: application/json
    urlParameters:
      provider:
        custom: []
        name: provider
        description: 'Provider code.'
        required: true
        example: null
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
    cleanUrlParameters:
      provider: null
    queryParameters: []
    cleanQueryParameters: []
    bodyParameters:
      event_id:
        custom: []
        name: event_id
        description: 'A unique event identifier from the provider.'
        required: false
        example: evt_123
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
      email:
        custom: []
        name: email
        description: 'Subscriber email the event relates to.'
        required: true
        example: john.doe@example.com
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
      status:
        custom: []
        name: status
        description: 'One of: active, unsubscribed.'
        required: true
        example: active
        type: string
        enumValues: []
        exampleWasSpecified: true
        nullable: false
        deprecated: false
    cleanBodyParameters:
      event_id: evt_123
      email: john.doe@example.com
      status: active
    fileParameters: []
    responses:
      -
        custom: []
        status: 204
        content: ''
        headers: []
        description: 'Accepted and applied'
      -
        custom: []
        status: 400
        content: '{"message":"Invalid webhook"}'
        headers: []
        description: 'Invalid webhook'
    responseFields: []
    auth: []
    controller: null
    method: null
    route: null
